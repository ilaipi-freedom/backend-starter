'use strict';const _0x318ab9=_0x3194;(function(_0xd5ed28,_0x5083ed){const _0x2167c9=_0x3194,_0x541819=_0xd5ed28();while(!![]){try{const _0xf1bb0c=-parseInt(_0x2167c9(0x1cb))/0x1*(-parseInt(_0x2167c9(0x16e))/0x2)+parseInt(_0x2167c9(0x185))/0x3*(parseInt(_0x2167c9(0x19c))/0x4)+parseInt(_0x2167c9(0x18d))/0x5+parseInt(_0x2167c9(0x19b))/0x6*(parseInt(_0x2167c9(0x19e))/0x7)+-parseInt(_0x2167c9(0x187))/0x8*(-parseInt(_0x2167c9(0x178))/0x9)+-parseInt(_0x2167c9(0x1a1))/0xa*(parseInt(_0x2167c9(0x186))/0xb)+parseInt(_0x2167c9(0x197))/0xc*(-parseInt(_0x2167c9(0x182))/0xd);if(_0xf1bb0c===_0x5083ed)break;else _0x541819['push'](_0x541819['shift']());}catch(_0x39293f){_0x541819['push'](_0x541819['shift']());}}}(_0xa1ce,0xaaa5b));function _0x3194(_0x1519e0,_0x37039b){const _0xa1ceeb=_0xa1ce();return _0x3194=function(_0x319441,_0x1a27db){_0x319441=_0x319441-0x168;let _0xee1ae0=_0xa1ceeb[_0x319441];return _0xee1ae0;},_0x3194(_0x1519e0,_0x37039b);}var __createBinding=this&&this[_0x318ab9(0x1a8)]||(Object[_0x318ab9(0x171)]?function(_0x24a354,_0x429141,_0x48b398,_0x1b2998){const _0x3cc4f0=_0x318ab9,_0x4bff52={'YFgTv':function(_0x199c46,_0x37355c){return _0x199c46===_0x37355c;},'HVdEF':function(_0x4ad372,_0x17ba89){return _0x4ad372 in _0x17ba89;},'XtIcK':_0x3cc4f0(0x18e)};if(_0x4bff52[_0x3cc4f0(0x198)](_0x1b2998,undefined))_0x1b2998=_0x48b398;var _0x4d4373=Object[_0x3cc4f0(0x17b)](_0x429141,_0x48b398);(!_0x4d4373||(_0x4bff52[_0x3cc4f0(0x1a7)](_0x4bff52[_0x3cc4f0(0x192)],_0x4d4373)?!_0x429141[_0x3cc4f0(0x180)]:_0x4d4373[_0x3cc4f0(0x1b1)]||_0x4d4373['configurable']))&&(_0x4d4373={'enumerable':!![],'get':function(){return _0x429141[_0x48b398];}}),Object[_0x3cc4f0(0x17a)](_0x24a354,_0x1b2998,_0x4d4373);}:function(_0x12da6c,_0x49a06d,_0x56d911,_0x128bc7){if(_0x128bc7===undefined)_0x128bc7=_0x56d911;_0x12da6c[_0x128bc7]=_0x49a06d[_0x56d911];}),__setModuleDefault=this&&this[_0x318ab9(0x1c0)]||(Object[_0x318ab9(0x171)]?function(_0x29a1c2,_0x3589fe){const _0x18e567=_0x318ab9,_0x4301ae={'HyLHS':_0x18e567(0x170)};Object['defineProperty'](_0x29a1c2,_0x4301ae['HyLHS'],{'enumerable':!![],'value':_0x3589fe});}:function(_0x2688b6,_0x57d273){const _0x376b63=_0x318ab9,_0xe32eb9={'Hugbl':'default'};_0x2688b6[_0xe32eb9[_0x376b63(0x1b8)]]=_0x57d273;}),__decorate=this&&this['__decorate']||function(_0x333006,_0x10cd0c,_0x23c64d,_0x6b18b1){const _0x3f7c56=_0x318ab9,_0x33b697={'gjXpr':function(_0x21e24d,_0x34f57c){return _0x21e24d<_0x34f57c;},'FxBEj':function(_0xf372b4,_0x478d06){return _0xf372b4===_0x478d06;},'yPjaA':function(_0x36e859,_0x2b027c){return _0x36e859===_0x2b027c;},'SQUhC':_0x3f7c56(0x169),'atVPi':function(_0x1d22a7,_0x350bc7){return _0x1d22a7<_0x350bc7;},'lVBrL':function(_0x42b4b1,_0x5bc640){return _0x42b4b1(_0x5bc640);},'LiVfs':function(_0x4db09a,_0x1d0cac,_0x1f2ea7){return _0x4db09a(_0x1d0cac,_0x1f2ea7);},'lRxFR':function(_0x3dc6fc,_0x226331){return _0x3dc6fc>_0x226331;}};var _0x1b0703=arguments[_0x3f7c56(0x16b)],_0x388f30=_0x33b697[_0x3f7c56(0x1b6)](_0x1b0703,0x3)?_0x10cd0c:_0x33b697[_0x3f7c56(0x16f)](_0x6b18b1,null)?_0x6b18b1=Object['getOwnPropertyDescriptor'](_0x10cd0c,_0x23c64d):_0x6b18b1,_0x54ebca;if(_0x33b697[_0x3f7c56(0x168)](typeof Reflect,_0x33b697['SQUhC'])&&typeof Reflect[_0x3f7c56(0x1b7)]==='function')_0x388f30=Reflect[_0x3f7c56(0x1b7)](_0x333006,_0x10cd0c,_0x23c64d,_0x6b18b1);else{for(var _0x4045b2=_0x333006[_0x3f7c56(0x16b)]-0x1;_0x4045b2>=0x0;_0x4045b2--)if(_0x54ebca=_0x333006[_0x4045b2])_0x388f30=(_0x33b697[_0x3f7c56(0x19a)](_0x1b0703,0x3)?_0x33b697['lVBrL'](_0x54ebca,_0x388f30):_0x1b0703>0x3?_0x54ebca(_0x10cd0c,_0x23c64d,_0x388f30):_0x33b697[_0x3f7c56(0x1b2)](_0x54ebca,_0x10cd0c,_0x23c64d))||_0x388f30;}return _0x33b697[_0x3f7c56(0x16d)](_0x1b0703,0x3)&&_0x388f30&&Object[_0x3f7c56(0x17a)](_0x10cd0c,_0x23c64d,_0x388f30),_0x388f30;},__importStar=this&&this['__importStar']||function(_0x16d4c1){const _0x5404a2=_0x318ab9,_0x1650ef={'uZQHw':function(_0x4bc30a,_0x25df44){return _0x4bc30a!=_0x25df44;},'Hywlb':function(_0x134114,_0x475db8){return _0x134114!==_0x475db8;},'AMmbl':function(_0x2cffaa,_0x266a3a,_0x4d72f7,_0x57ceb4){return _0x2cffaa(_0x266a3a,_0x4d72f7,_0x57ceb4);},'miHJR':function(_0x4fa059,_0x226762,_0x3ac70c){return _0x4fa059(_0x226762,_0x3ac70c);}};if(_0x16d4c1&&_0x16d4c1[_0x5404a2(0x180)])return _0x16d4c1;var _0x391712={};if(_0x1650ef['uZQHw'](_0x16d4c1,null)){for(var _0xecba5 in _0x16d4c1)if(_0x1650ef[_0x5404a2(0x190)](_0xecba5,_0x5404a2(0x170))&&Object[_0x5404a2(0x1c9)]['hasOwnProperty'][_0x5404a2(0x172)](_0x16d4c1,_0xecba5))_0x1650ef[_0x5404a2(0x1c8)](__createBinding,_0x391712,_0x16d4c1,_0xecba5);}return _0x1650ef['miHJR'](__setModuleDefault,_0x391712,_0x16d4c1),_0x391712;},__metadata=this&&this['__metadata']||function(_0x4f3841,_0x1b5ffd){const _0x5f5111=_0x318ab9,_0x382992={'RYGao':function(_0x2b681b,_0x14ba75){return _0x2b681b===_0x14ba75;},'eofgc':_0x5f5111(0x169),'GkpZj':function(_0x26c95a,_0x389183){return _0x26c95a===_0x389183;},'uIlUS':_0x5f5111(0x173)};if(_0x382992['RYGao'](typeof Reflect,_0x382992['eofgc'])&&_0x382992[_0x5f5111(0x1a6)](typeof Reflect[_0x5f5111(0x19f)],_0x382992['uIlUS']))return Reflect['metadata'](_0x4f3841,_0x1b5ffd);},__param=this&&this[_0x318ab9(0x1c6)]||function(_0x7bdafe,_0x899f26){const _0x19edf5={'viLvI':function(_0x273876,_0x34b744,_0x4101b2,_0x4b6c72){return _0x273876(_0x34b744,_0x4101b2,_0x4b6c72);}};return function(_0x4870b0,_0x5a5db6){const _0x425cd7=_0x3194;_0x19edf5[_0x425cd7(0x175)](_0x899f26,_0x4870b0,_0x5a5db6,_0x7bdafe);};},__importDefault=this&&this[_0x318ab9(0x189)]||function(_0xc4d729){const _0x1253ae=_0x318ab9;return _0xc4d729&&_0xc4d729[_0x1253ae(0x180)]?_0xc4d729:{'default':_0xc4d729};},AuthService_1;function _0xa1ce(){const _0x2c116d=['YFgTv','parse','atVPi','6UCSsBl','92SYZwBK','findUnique','6810706tEQarr','metadata','type','18480CwkJAB','validateUser','signIn','Inject','account','GkpZj','HVdEF','__createBinding','design:paramtypes','sessionKey','verify','DLzYi','date-fns','CACHE_MANAGER','password','AuthHelper','writable','LiVfs','env.appInstance','登录失败!','用户不存在，登录失败','gjXpr','decorate','Hugbl','登录已失效!','密码错误，登录失败','signOut','jwtService','perm','logger','AUTH','__setModuleDefault','@nestjs/config','@nestjs/jwt','exp','toFixed','UnauthorizedException','__param','stringify','AMmbl','prototype','../helpers/auth-helper','1gcZOYk','role','yPjaA','object','@nestjs/cache-manager','length','getTime','lRxFR','486704KHyrMQ','FxBEj','default','create','call','function','name','viLvI','Logger','log','45eNEAHW','set','defineProperty','getOwnPropertyDescriptor','corpId','verifyAccount','cacheManager','minus','__esModule','JwtService','4009499ovxdlV','ioredis','configService','147327zFmbMR','2519QpKJLp','1315832TAQPsn','AuthService','__importDefault','prisma','signAsync','argon2','6733020KjYWzl','get','BoXjV','Hywlb','Injectable','XtIcK','FOaos','redis','@nestjs/common','now','132sWoXAH'];_0xa1ce=function(){return _0x2c116d;};return _0xa1ce();}Object[_0x318ab9(0x17a)](exports,_0x318ab9(0x180),{'value':!![]}),exports[_0x318ab9(0x188)]=void 0x0;const cache_manager_1=require(_0x318ab9(0x16a)),common_1=require(_0x318ab9(0x195)),common_2=require(_0x318ab9(0x195)),config_1=require(_0x318ab9(0x1c1)),jwt_1=require(_0x318ab9(0x1c2)),argon2=__importStar(require(_0x318ab9(0x18c))),date_fns_1=require(_0x318ab9(0x1ad)),ioredis_1=__importDefault(require(_0x318ab9(0x183))),auth_helper_1=require(_0x318ab9(0x1ca)),number_helper_1=__importDefault(require('../helpers/number-helper')),prisma_service_1=require('../prisma/prisma.service');let AuthService=AuthService_1=class AuthService{constructor(_0x2691e2,_0x5ee7f0,_0x428e41,_0x191cba){const _0x1f8fac=_0x318ab9,_0x58f1ff={'BoXjV':'env.redis'};this[_0x1f8fac(0x1bc)]=_0x2691e2,this[_0x1f8fac(0x17e)]=_0x5ee7f0,this[_0x1f8fac(0x18a)]=_0x428e41,this[_0x1f8fac(0x184)]=_0x191cba,this[_0x1f8fac(0x1be)]=new common_2[(_0x1f8fac(0x176))](AuthService_1[_0x1f8fac(0x174)]),this[_0x1f8fac(0x194)]=new ioredis_1[(_0x1f8fac(0x170))](_0x191cba['get'](_0x58f1ff[_0x1f8fac(0x18f)]));}async[_0x318ab9(0x17d)](_0xecee2a,_0x5d4404){const _0x14428b=_0x318ab9,_0x26320e={'RSQxg':_0x14428b(0x1b5)},_0x53fd67=await this['prisma'][_0x14428b(0x1a5)][_0x14428b(0x19d)]({'where':{'username':_0xecee2a},'include':{'role':!![]}});if(!_0x53fd67){this['logger'][_0x14428b(0x177)]({'username':_0xecee2a},_0x26320e['RSQxg']);throw new common_1[(_0x14428b(0x1c5))](_0x14428b(0x1b4));}if(await argon2[_0x14428b(0x1ab)](_0x53fd67[_0x14428b(0x1af)],_0x5d4404))return _0x53fd67;else{this[_0x14428b(0x1be)][_0x14428b(0x177)]({'username':_0xecee2a},_0x14428b(0x1ba));throw new common_1['UnauthorizedException'](_0x14428b(0x1b4));}}async[_0x318ab9(0x1a3)](_0x18df44,_0x60aea1){const _0x246816=_0x318ab9,_0x46aaac={'skytF':_0x246816(0x1b3),'PSoGn':_0x246816(0x1bf),'DLzYi':function(_0x15c87a,_0x3ec815){return _0x15c87a*_0x3ec815;},'YuSDB':function(_0x4de929,_0x5c7c52){return _0x4de929(_0x5c7c52);}},_0xd7798=await this[_0x246816(0x17d)](_0x18df44,_0x60aea1),_0x35b1c9=await this['configService']['get'](_0x46aaac['skytF']),_0x243471={'id':_0xd7798['id'],'key':_0x46aaac['PSoGn'],'type':_0x35b1c9},_0x420e44=auth_helper_1['AuthHelper'][_0x246816(0x1aa)](_0x243471),_0x30287e=await this[_0x246816(0x1bc)][_0x246816(0x18b)](_0x243471),_0x8a1876=(0x0,date_fns_1['subMinutes'])(Date[_0x246816(0x196)](),0x1)[_0x246816(0x16c)](),_0x58f31e=await this[_0x246816(0x1bc)]['verifyAsync'](_0x30287e),_0x47d948=number_helper_1[_0x246816(0x170)][_0x246816(0x17f)](_0x46aaac[_0x246816(0x1ac)](_0x58f31e[_0x246816(0x1c3)],0x3e8),_0x8a1876)[_0x246816(0x1c4)](0x0),_0x415c94={'id':_0xd7798['id'],'type':_0x35b1c9,'username':_0xd7798['username'],'token':_0x30287e,'role':_0xd7798['role'][_0x246816(0x1bd)],'corpId':_0xd7798[_0x246816(0x17c)]};return await this['cacheManager'][_0x246816(0x179)](_0x420e44,JSON[_0x246816(0x1c7)](_0x415c94),_0x46aaac['YuSDB'](Number,_0x47d948)),{'id':_0xd7798['id'],'role':_0xd7798[_0x246816(0x1cc)][_0x246816(0x1bd)],'token':_0x30287e};}async[_0x318ab9(0x1bb)](_0x3ecbd2){const _0xd11247=_0x318ab9,_0x57ab54={'Dovya':'AUTH'},_0x503783={'id':_0x3ecbd2['id'],'key':_0x57ab54['Dovya'],'type':_0x3ecbd2[_0xd11247(0x1a0)]},_0x3e03b5=auth_helper_1['AuthHelper'][_0xd11247(0x1aa)](_0x503783);await this[_0xd11247(0x17e)]['del'](_0x3e03b5);}async[_0x318ab9(0x1a2)](_0x22be60){const _0x3caa54=_0x318ab9,_0x3bde51={'FOaos':_0x3caa54(0x1b9)},_0x4b7496=auth_helper_1[_0x3caa54(0x1b0)][_0x3caa54(0x1aa)](_0x22be60),_0x5c3173=await this['cacheManager'][_0x3caa54(0x18e)](_0x4b7496);if(_0x5c3173)return JSON[_0x3caa54(0x199)](_0x5c3173);throw new common_1[(_0x3caa54(0x1c5))](_0x3bde51[_0x3caa54(0x193)]);}};exports['AuthService']=AuthService,exports[_0x318ab9(0x188)]=AuthService=AuthService_1=__decorate([(0x0,common_1[_0x318ab9(0x191)])(),__param(0x1,(0x0,common_1[_0x318ab9(0x1a4)])(cache_manager_1[_0x318ab9(0x1ae)])),__metadata(_0x318ab9(0x1a9),[jwt_1[_0x318ab9(0x181)],Object,prisma_service_1['PrismaService'],config_1['ConfigService']])],AuthService);
//# sourceMappingURL=auth.service.js.map